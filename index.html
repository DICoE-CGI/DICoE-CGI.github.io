Setting up ACA-Py Development Environment
To do development on ACA-Py, you need to have a local environment that you can use to test out your changes.  The following provides information on how to setup your local environment, run ACA-Py, and run the unit tests.
Install ACA-Py:
1.	Clone the ACA-Py repo
Clone the Github repo https://github.com/hyperledger/aries-cloudagent-python. 
This step works only on linux, so we need either wsl or ubuntu. It will give some errors on Windows. 
2.	Install the dependencies (Local install)
ACA-Py depends on Python 3.6/Python 3.9, PIP.
Install Python 3.9 and run the following commands.
cd aries-cloudagent-python
pip install -e .
pip install -r requirements.txt \
 -r requirements.dev.txt \
 -r requirements.askar.txt \
 -r requirements.indy.txt
Running ACA-Py:
There are two steps to running ACA-Py.  The first step is to provision the database and the second is running the agent.  You need to provision any new wallet database, but you only need to do it once.
You can run ACA-Py from the command line, as a docker container from a repository, or as a PIP package.  Eventually your work will be used in a docker container, but for development and initial testing you should be using the command line.
Before provisioning, the wallet seed needs to be registered on the ledger with Endorser role on http://test.bcovrin.vonx.io
Provision a wallet:
aca-py provision \
--wallet-type askar \
--endpoint localhost \
--seed 100A000000300000c0000CANTest0001 \
--wallet-name AdminTest \
--wallet-key MASTER_KEY \
--genesis-url http://test.bcovrin.vonx.io/genesis
Here are what the parameters mean:
--wallet-type indy 
This specifies that the wallet database that is being created is the default one that comes from the LIbindy.so library and uses SQLite.  In production we will be using the Askar database type and it will run in Postgres.  For most cases this difference should not be meaningful to your development.
--endpoint localhost
This is used to tell other systems where to find ACA-Py.  For your local environment localhost is fine as your local environment is probably not internet addressable.
--seed 100A000000300000c0000CANTest0001
The seed is the equivalent to your private key.  It will be used in signing digital signatures and in secure communications.  It has to be exactly 32 characters long and for each wallet it needs to be unique.  You have to use the same seed in your provision that you do in the start command.
--wallet-name AdminTest
The wallet name will be the name of the wallet database that will be created using the provision command.  You have to use the same wallet name in your provision as you do in the start command.
--wallet-key
The data that is stored in the wallet database is encrypted at rest.  If you view the data in SQLite or Postgres the field contents are encrypted.  The encryption is doing using the wallet key.  You need to use the same wallet key in the provision as you do in the  start command.
--genesis-url http://test.bcovrin.vonx.io/genesis
The genesis url is a pointer to a list of nodes in the verifiable data registry.  In this example I am using the BCovrin test network run by the province of BC.  You can just as easily point to the CANdy test network genesis file.
Run ACA-PY using start command:
aca-py start \
--inbound-transport http 0.0.0.0 8000 \
--endpoint localhost \
--outbound-transport http \
--admin 0.0.0.0 8080 \
--genesis-url http://test.bcovrin.vonx.io/genesis  \
--wallet-type indy \
--wallet-name AdminTest \
--wallet-key MASTER_KEY \
--seed 100A000000300000c0000CANTest0001 \
--admin-insecure-mode \
--label ADMIN_AGENT \
--log-level debug \
--no-receive-invites \
--storage-type indy \
--auto-ping-connection \
--webhook-url http://localhost:3000 \
--plugin myPlugin
Here are what the parameters mean:
--inbound-transport http 0.0.0.0 8000
The inbound transport specifies what transport protocol to use, who can access it and at what port.  In this example we are using HTTP as the protocol, 0.0.0.0 means that anyone on the internet can access this service, and they will access it at port 8000.  This is for the public interface to the agent.  It is the interface that other agents use to communicate to it.  Inbound communication will take place at the IP address specified in the endpoint at the port specified in this parameter.
--outbound-transport http
This is the transfer protocol that will be used by the agent to talk to other agents.
--admin 0.0.0.0 8080
The admin interface is used internally by the controller or other applications that you have written that need to control the ACA-Py agent.  All the REST API calls of ACA-Py will be made available on port 8080 and will open to anyone.  Calls to the admin interface will be made to the endpoint IP address at the port specified by this parameter.
--admin-insecure-mode
This turns off the API Key option in using calls to the admin REST API.  Only use this in development systems.
--log-level debug
This sets the ACA-Py to write out debug messages to the stdout.  These messages are useful in telling what is happening in ACA-Py or your changes to it.
--no-receive-invites
This turns off the ability for your ACA-Py to receive invitations to connect to other systems.  You will most likely not need to handle invites sent to you.
--auto-ping-connection
At the end of a connection, some agents wait for a ping to make sure it is complete.  
--webhook-url http://localhost:3000
If you are developing a controller, you need to specify to ACA-Py where to make webhook calls that happen when ACA_py encounters events that might be useful for the controller to know about or for ACA_Py to get input from the controller on how to behave to the event.
--plugin myPlugin
This parameter specifies the name of the ACA-Py plugin to install.  See the Plugin section of this document.
Running Tests
ACA-Py has a series of test that can be run using pytest.  
Install pytest with flake8 using:
pip install pytest-flake8
Now you can run the tests from the aries-cloudagent-python root folder using:
pytest
Developing Plugins
As much as possible, changes to ACA-Py should be encapsulated in a plugin so that the deployment cycle does not depend on merging changes in to the core code of ACA-Py.  Core changes take a long time to get approved and merged and could be rejected by the community.
Plugins can be used to:
-	Add new REST API endpoints to the admin interface
-	Adding new protocols 
-	Defining message types
-	Override existing classes using the dependency manager
Follow this guide for the current methods of developing plugins.
https://github.com/hyperledger/aries-cloudagent-python/blob/main/docs/GettingStartedAriesDev/PlugIns.md
Tools to aid in development
The ACA-Py agent does not run on its own, it runs in conjunction with other agents and a verifiable data registry.  Here are several tools that you might want to use to help test your agent.
-	ACA-Py admin swagger interface: You can point your browser to the admin interface to get the swagger interface.  You can use it to see all of the endpoints, their parameters, and curl calling commands.
-	Business Partner Agent:  a flexible open-source web interface to a known working ACA-Py agent.
-	Ledger browser: based on the verifiable data registry you are using, there may be a ledger browser you can use to see what has been written to the ledger.  
o	BCovrin: http://test.bcovrin.vonx.io/
o	CANdy-dev: https://candyscan.idlab.org/home/CANDY_DEV
-	Bifold mobile agent: repo for the generic version of the Ontario wallet.  You can use this to build a copy of the wallet that can run locally.  
https://github.com/hyperledger/aries-mobile-agent-react-native

